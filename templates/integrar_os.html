{% extends "base.html" %}

{% block title %}Integrar Ordem de Serviço - Pólis{% endblock %}

{% block content %}
<div class="page-header">
    <h2 class="page-title"><i class="fas fa-network-wired"></i> Integrar Ordem de Serviço</h2>
</div>

{# Secção para Adicionar OS Manualmente #}
<div class="card mb-4">
    <div class="card-header">
        <h3><i class="fas fa-plus-circle"></i> Adicionar Nova OS Manualmente</h3>
    </div>
    <div class="card-body">
        <p class="text-muted small">Preencha os campos abaixo para adicionar uma nova Ordem de Serviço ao sistema de cobranças.</p>
        <form method="POST" action="{{ url_for('integrar_os') }}"> {# Ação do formulário aponta para a própria rota #}
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="hidden" name="action" value="add_os_manual"/> {# Para identificar a ação no backend #}

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="pedido">Pedido Vinculado:</label>
                    <input type="text" id="pedido" name="pedido" class="form-control" value="{{ request.form.pedido or '' }}" placeholder="Nº do Pedido a que esta OS pertence" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="os">Número da OS:</label>
                    <input type="text" id="os" name="os" class="form-control" value="{{ request.form.os or '' }}" placeholder="Nº da Ordem de Serviço" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="placa">Placa do Veículo:</label>
                    <input type="text" id="placa" name="placa" class="form-control" value="{{ request.form.placa or '' }}" placeholder="XXX-0000 ou XXX0X00" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="filial">Filial:</label>
                    <input type="text" id="filial" name="filial" class="form-control" value="{{ request.form.filial or '' }}" placeholder="Nome ou código da filial" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="transportadora">Transportadora:</label>
                <input type="text" id="transportadora" name="transportadora" class="form-control" value="{{ request.form.transportadora or '' }}" placeholder="Nome da transportadora" required>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="status_cobranca">Status da Cobrança:</label>
                    <select id="status_cobranca" name="status_cobranca" class="form-control" required>
                        <option value="">Selecione...</option>
                        <option value="Com cobrança" {% if request.form.status_cobranca == 'Com cobrança' %}selected{% endif %}>Com cobrança</option>
                        <option value="Sem cobrança" {% if request.form.status_cobranca == 'Sem cobrança' %}selected{% endif %}>Sem cobrança</option>
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label for="conformidade">Conformidade:</label>
                    <select id="conformidade" name="conformidade" class="form-control" required>
                        <option value="">Selecione...</option>
                        <option value="Conforme" {% if request.form.conformidade == 'Conforme' %}selected{% endif %}>Conforme</option>
                        <option value="Verificar" {% if request.form.conformidade == 'Verificar' %}selected{% endif %}>Verificar</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="data_emissao_pedido">Data de Emissão do Pedido (Opcional):</label>
                <input type="date" id="data_emissao_pedido" name="data_emissao_pedido" class="form-control" value="{{ request.form.data_emissao_pedido or '' }}">
                <small class="text-muted">Se não informada, o sistema tentará buscar da tabela de pendências, se o pedido existir lá.</small>
            </div>

            <div class="form-group mt-4">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Adicionar OS</button>
                <a href="{{ url_for('home') }}" class="btn btn-secondary">Cancelar</a> {# Botão Cancelar volta para Home #}
            </div>
        </form>
    </div>
</div>

{# Secção para Vincular OS a Pedido Finalizado (Placeholder da funcionalidade) #}
<div class="card mt-4">
    <div class="card-header">
        <h3><i class="fas fa-link"></i> Vincular OS a Pedido Finalizado e Transferir para Cobranças</h3>
    </div>
    <div class="card-body">
        <p class="text-muted">Funcionalidade para selecionar um pedido finalizado (da tabela de pendências) e associar uma nova OS, criando um registo em cobranças.</p>
        <p class="text-info"><i class="fas fa-info-circle"></i> Esta funcionalidade será implementada numa próxima etapa.</p>
        {# Aqui viria a interface para selecionar pedido de pendentes e inserir dados da OS #}
    </div>
</div>

{% endblock %}

{% block head_extra %}
{{ super() }}
<style>
    .form-row { display: flex; flex-wrap: wrap; margin-right: -7.5px; margin-left: -7.5px; }
    .form-row > .col-md-6 { padding-right: 7.5px; padding-left: 7.5px; flex: 0 0 50%; max-width: 50%; }
    @media (max-width: 768px) { .form-row > .col-md-6 { flex: 0 0 100%; max-width: 100%; } }
</style>
{% endblock %}
